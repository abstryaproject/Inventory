<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Investment Tracker Dashboard</title>
<style>
  body { font-family: Arial; background: #f5f6fa; margin:0; padding:0; }
  .app { max-width: 700px; margin: auto; padding:20px; }
  h1,h2 { text-align:center; }
  .summary { background:white; padding:15px; border-radius:10px; margin-bottom:20px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
  button { width:100%; padding:12px; border:none; border-radius:8px; background:#1e90ff; color:white; font-size:16px; cursor:pointer; margin:5px 0;}
  button:hover { background:#0c75d8;}
  .trade { background:white; padding:10px; margin-top:10px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
  .profit { color:green; } .loss { color:red; }
  .modal { display:none; position:fixed; z-index:10; left:0; top:0; width:100%; height:100%; overflow:auto; background-color: rgba(0,0,0,0.5);}
  .modal-content { background:white; margin:10% auto; padding:20px; border-radius:10px; max-width:400px; box-shadow:0 4px 8px rgba(0,0,0,0.2);}
  .close { color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer; }
  .close:hover { color:black; }
  .modal input { width:100%; padding:10px; margin:5px 0; border-radius:8px; border:1px solid #ddd; }
  .filters { display:flex; justify-content:space-around; margin-bottom:15px; }
  .filters button { width:auto; padding:8px 12px; font-size:14px; }
  .b2 button { width:auto; padding:8px 12px; font-size:14px; }
  canvas { background:white; border-radius:10px; padding:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
</style>
</head>
<body>
<div class="app">
<h1>üìà Investment Tracker Dashboard</h1>
<button id="openFormBtn">‚ûï Add Trade</button>

<!-- Modal Form -->
<div id="tradeModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h2>Add / Edit Trade</h2>
    <input type="text" id="asset" placeholder="Asset / Share Name">
    <input type="number" id="buyPrice" placeholder="Buy Price">
    <input type="number" id="unitsBought" placeholder="Units Bought">
    <input type="number" id="sellPrice" placeholder="Sell Price (optional)">
    <input type="number" id="unitsSold" placeholder="Units Sold (optional)">
    <button id="saveTradeBtn">üíæ Save Trade</button>
  </div>
</div>
  <br/></br/>
  <div class="filters">
  <button onclick="setFilter('All')">All Trades</button>
  <button onclick="setFilter('Open')">Open Trades</button>
  <button onclick="setFilter('Closed')">Closed Trades</button>
</div>
<div class="summary">
  <p>Total Invested: ‚Ç¶<span id="totalInvested">0</span></p>
  <p>Total Profit/Loss: ‚Ç¶<span id="totalProfit">0</span></p>
</div>
<div id="history"></div>
<h2>üìä Profit/Loss per Trade</h2>
<canvas id="profitChart" width="400" height="200"></canvas>

<h2>üìä Portfolio Composition</h2>
<canvas id="portfolioChart" width="400" height="200"></canvas>

<h2>üìä Buy vs Sell (Stacked)</h2>
<canvas id="buySellChart" width="400" height="200"></canvas>

<h2>üìä Remaining Shares</h2>
<canvas id="remainingChart" width="400" height="200"></canvas>

<h2>üìä Cumulative Profit Over Time</h2>
<canvas id="cumulativeChart" width="400" height="200"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let trades = JSON.parse(localStorage.getItem("trades")) || [];
let editIndex = null;
let filterStatus = "All";

// Pagination
let currentPage = 1;
const itemsPerPage = 2;

// Chart instances
let profitChartInstance, portfolioChartInstance, buySellChartInstance, remainingChartInstance, cumulativeChartInstance;

const modal = document.getElementById("tradeModal");
const openFormBtn = document.getElementById("openFormBtn");
const closeModal = document.getElementById("closeModal");
const saveTradeBtn = document.getElementById("saveTradeBtn");

openFormBtn.onclick = () => modal.style.display = "block";
closeModal.onclick = () => { modal.style.display = "none"; clearForm(); }
window.onclick = (event) => { if (event.target==modal) { modal.style.display="none"; clearForm(); } }
saveTradeBtn.onclick = () => saveTrade(editIndex);

function saveTrade(index=null){
  const asset=document.getElementById("asset").value.trim();
  const buyPrice=parseFloat(document.getElementById("buyPrice").value);
  const unitsBought=parseFloat(document.getElementById("unitsBought").value);
  const sellPrice=parseFloat(document.getElementById("sellPrice").value)||0;
  const unitsSold=parseFloat(document.getElementById("unitsSold").value)||0;

  if(!asset||!buyPrice||!unitsBought){ alert("Fill Asset, Buy Price & Units Bought."); return;}
  if(unitsSold>unitsBought){ alert("Units sold cannot exceed units bought."); return;}

  const buyValueSold = buyPrice*unitsSold;
  const sellValue = sellPrice*unitsSold;
  const profit = sellValue - buyValueSold;
  const remaining = unitsBought - unitsSold;

  const trade={asset,buyPrice,unitsBought,sellPrice,unitsSold,buyValueTotal:buyPrice*unitsBought,sellValue,profit,remaining};

  if(index!==null) trades[index]=trade; else trades.push(trade);

  localStorage.setItem("trades",JSON.stringify(trades));
  renderTrades();
  clearForm();
  modal.style.display="none";
  editIndex=null;
}

function renderTrades(){
  const history = document.getElementById("history");
  history.innerHTML = "";

  let totalInvested = 0;
  let totalProfit = 0;

  // Apply filter
  const filteredTrades = trades.filter(trade => {
    const status = trade.remaining === 0 ? "Closed ‚úÖ" : "Open ‚è≥";
    if(filterStatus === "All") return true;
    if(filterStatus === "Open" && status === "Open ‚è≥") return true;
    if(filterStatus === "Closed" && status === "Closed ‚úÖ") return true;
    return false;
  });

  const totalPages = Math.ceil(filteredTrades.length / itemsPerPage);
  if(currentPage > totalPages) currentPage = totalPages || 1;

  const start = (currentPage - 1) * itemsPerPage;
  const paginatedTrades = filteredTrades.slice(start, start + itemsPerPage);

  paginatedTrades.forEach((trade)=>{
    totalInvested += trade.buyValueTotal;
    totalProfit += trade.profit;
    const status = trade.remaining === 0 ? "Closed ‚úÖ" : "Open ‚è≥";

    history.innerHTML += `
      <div class="trade">
        <strong>${trade.asset}</strong> - <em>${status}</em><br>
        Buy: ‚Ç¶${trade.buyPrice} √ó ${trade.unitsBought}<br>
        Sold: ‚Ç¶${trade.sellPrice || "-"} √ó ${trade.unitsSold || "-"}<br>
        Remaining: ${trade.remaining}<br>
        <span class="${trade.profit >= 0 ? "profit" : "loss"}">Profit/Loss: ‚Ç¶${trade.profit.toFixed(2)}</span><br>
        <button style="width:50%; margin-right:5px;" onclick="editTrade(${trades.indexOf(trade)})">‚úè Edit</button>
        <button style="width:45%; background-color:red; color:white;" onclick="confirmDelete(${trades.indexOf(trade)})">üóë Delete</button>
      </div>`;
  });

  // Pagination buttons
  if(totalPages > 1){
    history.innerHTML += `<div style="display:flex; justify-content:space-between; margin-top:10px;">
      ${currentPage > 1 ? '<button onclick="prevPage()">‚¨Ö Previous</button>' : '<div></div>'}
      ${currentPage < totalPages ? '<button onclick="nextPage()">Next ‚û°</button>' : '<div></div>'}
    </div>`;
  }

  document.getElementById("totalInvested").innerText = totalInvested.toFixed(2);
  document.getElementById("totalProfit").innerText = totalProfit.toFixed(2);

  renderAllCharts();
}

function nextPage(){ currentPage++; renderTrades(); }
function prevPage(){ currentPage--; renderTrades(); }

function confirmDelete(index){
  const trade = trades[index];
  if(confirm(`Are you sure you want to delete the trade: ${trade.asset}?`)){
    trades.splice(index,1);
    localStorage.setItem("trades",JSON.stringify(trades));
    renderTrades();
  }
}

function editTrade(index){
  const trade=trades[index];
  document.getElementById("asset").value=trade.asset;
  document.getElementById("buyPrice").value=trade.buyPrice;
  document.getElementById("unitsBought").value=trade.unitsBought;
  document.getElementById("sellPrice").value=trade.sellPrice;
  document.getElementById("unitsSold").value=trade.unitsSold;

  modal.style.display="block";
  editIndex=index;
}

function clearForm(){ 
  document.getElementById("asset").value=""; 
  document.getElementById("buyPrice").value=""; 
  document.getElementById("unitsBought").value=""; 
  document.getElementById("sellPrice").value=""; 
  document.getElementById("unitsSold").value=""; 
  editIndex=null;
}
function setFilter(status){ filterStatus=status; currentPage = 1; renderTrades(); }

function renderAllCharts(){

  const labels = trades.map(t=>t.asset);
  const profitData = trades.map(t => ((t.sellPrice || 0)*t.unitsSold) - (t.buyPrice*t.unitsSold));
  const portfolioData = trades.map(t=>t.buyValueTotal);
  const buyData = trades.map(t=>t.buyValueTotal);
  const sellData = trades.map(t=>t.sellValue);
  const remainingData = trades.map(t=>t.remaining);
  let cumulative=0;
  const cumulativeData = trades.map(t => { cumulative += ((t.sellPrice||0)*t.unitsSold - t.buyPrice*t.unitsSold); return cumulative; });

  if(profitChartInstance) profitChartInstance.destroy();
  profitChartInstance = new Chart(document.getElementById("profitChart"), {
    type:'bar', data:{labels, datasets:[{label:'Profit/Loss per Sold Units', data:profitData,
    backgroundColor:profitData.map(p=>p>=0?'rgba(75,192,192,0.7)':'rgba(255,99,132,0.7)'),
    borderColor:profitData.map(p=>p>=0?'rgba(75,192,192,1)':'rgba(255,99,132,1)'), borderWidth:1}]} ,
    options:{responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
  });

  if(portfolioChartInstance) portfolioChartInstance.destroy();
  portfolioChartInstance = new Chart(document.getElementById("portfolioChart"),{
    type:'doughnut', data:{labels, datasets:[{data:portfolioData, backgroundColor:labels.map(()=>`hsl(${Math.random()*360},70%,60%)`)}]},
    options:{responsive:true, plugins:{legend:{position:'bottom'}}}
  });

  if(buySellChartInstance) buySellChartInstance.destroy();
  buySellChartInstance = new Chart(document.getElementById("buySellChart"),{
    type:'bar', data:{labels, datasets:[
      {label:'Buy', data:buyData, backgroundColor:'rgba(54,162,235,0.7)'},
      {label:'Sell', data:sellData, backgroundColor:'rgba(255,206,86,0.7)'}
    ]},
    options:{responsive:true, plugins:{legend:{position:'bottom'}}, scales:{x:{stacked:true}, y:{stacked:true}}}
  });

  if(remainingChartInstance) remainingChartInstance.destroy();
  remainingChartInstance = new Chart(document.getElementById("remainingChart"),{
    type:'bar', data:{labels, datasets:[{label:'Remaining Units', data:remainingData, backgroundColor:'rgba(255,99,132,0.7)'}]},
    options:{indexAxis:'y', responsive:true, plugins:{legend:{display:false}}, scales:{x:{beginAtZero:true}}}
  });

  if(cumulativeChartInstance) cumulativeChartInstance.destroy();
  cumulativeChartInstance = new Chart(document.getElementById("cumulativeChart"),{
    type:'line', data:{labels, datasets:[{label:'Cumulative Profit', data:cumulativeData, borderColor:'rgba(75,192,192,1)', fill:false}]},
    options:{responsive:true, plugins:{legend:{position:'bottom'}}, scales:{y:{beginAtZero:true}}}
  });

}

renderTrades();
</script>
</body>
</html>